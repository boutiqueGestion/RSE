<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Composants Électroniques - Recherche Sécurisée</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    input, button { padding: 8px; margin: 5px; }
    .chip-card {
      background: white; border: 1px solid #ccc; border-radius: 10px;
      padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .chip-img { float: right; width: 100px; margin-left: 10px; }
    .login-form { margin: 20px 0; }
    .form-container { display: flex; justify-content: center; align-items: center; height: 100vh; }
    button { background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px; }
    button:hover { background-color: #0056b3; }
  </style>
</head>
<body>

<div id="login-container" class="form-container">
  <div class="login-form">
    <h2>Connexion</h2>
    <input type="text" id="loginName" placeholder="Nom d'utilisateur"><br>
    <input type="password" id="loginPassword" placeholder="Mot de passe"><br>
    <button onclick="login()">Se connecter</button>
    <p>Pas de compte ? <a href="#" onclick="alert('L\'inscription est désactivée.')">Contactez l\'administrateur</a></p>
  </div>
</div>

<div id="app-container" style="display:none;">
  <h2>Recherche de composants électroniques</h2>

  <input type="text" id="apiKey" placeholder="Votre clé API OpenAI">
  <br>
  <input type="text" id="searchAll" placeholder="Rechercher (nom, type, tension...)">
  <button onclick="filterChips()">Rechercher</button>
  <button onclick="startVoiceSearch()">Microphone</button>
  <button onclick="exportPDF()">Télécharger PDF</button>
  <button onclick="exportExcel()">Télécharger Excel</button>
  <button onclick="searchOnline()">Rechercher en ligne</button>

  <!-- Admin-specific buttons -->
  <div id="admin-actions" style="display:none;">
    <button onclick="manageComponents()">Gérer les composants</button>
    <button onclick="manageUsers()">Gérer les utilisateurs</button>
  </div>

  <div id="results"></div>
</div>

<script>
let users = {
  "admin": { password: "admin1342", role: "admin" },
  "user1": { password: "bsacko1342", role: "bsacko" }
};

let currentUser = null;
let currentRole = null;

function login() {
  const name = document.getElementById("loginName").value;
  const password = document.getElementById("loginPassword").value;
  if (users[name] && users[name].password === password) {
    currentUser = name;
    currentRole = users[name].role;
    document.getElementById("login-container").style.display = "none";
    document.getElementById("app-container").style.display = "block";

    // Show admin panel if the user is an admin
    if (currentRole === "admin") {
      document.getElementById("admin-actions").style.display = "block";
    }
  } else {
    alert("Nom ou mot de passe incorrect !");
  }
}

// Données exemple
const chips = [
  { nom: "NE555", type: "Timer", broches: 8, tension: "5V", puissance: "0.3W", ampérage: "10mA", fréquence: "1Hz", modèle: "NE555", description: "Timer utilisé pour temporisations, PWM.", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/57/NE555.jpg/200px-NE555.jpg", usage: "Temporisation" },
  { nom: "ATmega328", type: "Microcontrôleur", broches: 28, tension: "5V", puissance: "15mW", ampérage: "5mA", fréquence: "16MHz", modèle: "ATmega328", description: "Microcontrôleur Arduino", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/ATmega328.jpg/220px-ATmega328.jpg", usage: "Arduino" }
];

function filterChips() {
  if (currentRole !== "admin" && currentRole !== "user") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }
  
  const text = document.getElementById("searchAll").value.toLowerCase();
  const results = chips.filter(c =>
    Object.values(c).some(v => v.toString().toLowerCase().includes(text))
  );
  displayResults(results);
}

function displayResults(data) {
  const container = document.getElementById("results");
  container.innerHTML = "";
  if (data.length === 0) {
    container.innerHTML = "<p>Aucun résultat.</p>";
    return;
  }
  data.forEach(c => {
    container.innerHTML += `
      <div class="chip-card">
        <img src="${c.image}" class="chip-img" alt="${c.nom}">
        <h3>${c.nom} (${c.type})</h3>
        <p><strong>Broches:</strong> ${c.broches} | <strong>Tension:</strong> ${c.tension}</p>
        <p><strong>Puissance:</strong> ${c.puissance} | <strong>Ampérage:</strong> ${c.ampérage}</p>
        <p><strong>Fréquence:</strong> ${c.fréquence} | <strong>Modèle:</strong> ${c.modèle}</p>
        <p><strong>Description:</strong> ${c.description}</p>
        <p><strong>Usage:</strong> ${c.usage}</p>
        <button onclick="askChatGPT('${c.nom}')">Demander à ChatGPT</button>
      </div>`;
  });
}

async function askChatGPT(question) {
  if (currentRole !== "admin" && currentRole !== "user") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }

  const apiKey = document.getElementById("apiKey").value;
  if (!apiKey) return alert("Entrez votre clé API OpenAI !");
  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + apiKey,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: "Donne-moi des infos sur " + question }]
    })
  });
  const data = await response.json();
  alert(data.choices[0].message.content);
}

// Microphone vocal
function startVoiceSearch() {
  if (currentRole !== "admin" && currentRole !== "user") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }

  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "fr-FR";
  recognition.start();
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById("searchAll").value = transcript;
    filterChips();
  };
}

// Export PDF
function exportPDF() {
  if (currentRole !== "admin" && currentRole !== "user") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;
  chips.forEach(c => {
    doc.text(`${c.nom} - ${c.type}`, 10, y);
    y += 10;
  });
  doc.save("composants.pdf");
}

// Export Excel
function exportExcel() {
  if (currentRole !== "admin" && currentRole !== "user") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }

  const ws = XLSX.utils.json_to_sheet(chips);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Composants");
  XLSX.writeFile(wb, "composants.xlsx");
}

// Recherche en ligne
function searchOnline() {
  if (currentRole !== "admin" && currentRole !== "user") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }

  // Implémentation de recherche en ligne ici
  alert("Recherche en ligne...");
}

// Gérer les composants (Admin only)
function manageComponents() {
  if (currentRole !== "admin") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }
  alert("Gérer les composants - Fonctionnalité à implémenter.");
}

// Gérer les utilisateurs (Admin only)
function manageUsers() {
  if (currentRole !== "admin") {
    alert("Vous n'avez pas les permissions nécessaires pour cette action.");
    return;
  }
  alert("Gérer les utilisateurs - Fonctionnalité à implémenter.");
}

</script>

</body>
</html>
